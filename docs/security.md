# セキュリティ用語まとめ

## 参考
- [体系的に学ぶ 安全なWebアプリケーションの作り方](https://www.sbcr.jp/product/4797393163/)
- [Rails セキュリティガイド](https://railsguides.jp/security.html)

## 用語解説
- 同一オリジンポリシーはサイトをまたがったアクセスを禁止する制限のこと
- CORS(Cross-Origin Resource Sharing, オリジン間リソース共有)は、サイトを超えてデータをやりとりできる仕様のこと
- アプリケーションの脆弱性は、入力と出力のうち、出力側でしか発生しない。出力側の脆弱性は"インジェクション"とつくことが多い

## クロスサイト・スクリプティング(XSS)
- 攻撃対象は、外部からの入力を受け付けるHTML,JSのコードで、サーバー側での主に`<`や`"`のエスケープ漏れが原因
- 攻撃例は、URLのクエリパラメータにクッキーを盗み出すJSを埋め込む方法がある
- 攻撃の影響は、攻撃者がクッキーを盗み、あらゆるサイトで利用者のなりすましを行う
- 対策は、サーバー側でフォームのimput要素を受け取る属性値をダブルクォートで囲む
- 対策は、外部から受け取るURLのメタ文字をエスケープする

## クロスサイト・リクエストフォージェリ(CSRF)
- フォージェリ(forgery)とは偽造という意味であり
- クロスサイト・リクエストフォージェリとは、別のサイト(クロスサイト)から自サイトに偽造された(フォージェリ)なリクエストを送信すること
- XSSとの違いは、CSRFは、自サーバーのみに不正なリクエストをされるという点が特異となる
- 攻撃対象は、フォームを送信する送信するコードで、form要素のaction属性にクレジットカード決済や口座送金などの重要な処理を行うURLを指定しした罠のHTMLファイルを設置する
- 攻撃対象サイトは、クッキーのみでセッション管理が行われているサイトやHTTP認証、TLSクライアント証明書のみで利用者の識別が行われているサイト
- 攻撃の影響は、被害者の権限で「重要な処理」が実行させられる
- 全般の対策は、重要な処理の前に、利用者が意図したリクエストかをサーバーで判定する
- 対策は、サーバーで秘匿情報(トークン)をPOSTのフォーム描画時に埋め込み、フォームが送信されたらトークンを検証する
- 対策は、パスワード再入力フォームをフォーム最終画面に設置する
- 対策は、フォーム送信時にサーバーでRefererをチェックする

## SQLインジェクション
- 攻撃方法は、inputタグやURLパスに、不正なSELECTなどのクエリを入力しリクエストを送る
- 影響は、データベース内の情報が盗まれる、書き換えられる、認証を回避されるなどがある
- 対策は、プレースホルダー「?」を使ってクエリを組み立てる

## セッションハイジャック
- 攻撃方法は、セッションIDが第三者に知られ、利用者になりすましてアクセスされること
- 影響は、利用者の重要情報の閲覧、利用者の持つ権限での操作(送金、物品購入など)
- 原因は、セッション生成でセッションID生成方法が連番の場合や、OSSのセッション生成で、ロジックが知られている場合であり
  対策は、セッション管理機構を自作せず、実績のある言語やミドルウェアが提供するセッション管理機構を利用する
- 原因は、アプリケーションの脆弱性で、XSS、HTTPヘッダ・インジェクション(Refererヘッダー)、URLに埋め込まれたセッションIDによって盗まれる場合であり、
  対策は、アプリケーション側のプログラミングによって対策する
- 原因は、セッションIDの固定化であり
  対策は、認証後にセッションIDを変更する
  対策は、トークン(nonceなど)をクッキー(ブラウザ側)とセッション変数(Web側)に保存し、重要な処理時の認証にトークンを突合する
